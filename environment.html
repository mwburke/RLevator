
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Environment &#8212; RLevator  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="rlevator package" href="rlevator.html" />
    <link rel="prev" title="Welcome to RLevator’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="environment">
<h1>Environment<a class="headerlink" href="#environment" title="Permalink to this heading">¶</a></h1>
<p>This environment simulates a turn-based, multi-decision elevator control system to carry passengers from their arrival floors to their destination floors. We say multi-decision rather than multi-agent because we have a single agent making decisions for every available elevator.</p>
<section id="environment-components">
<h2>Environment Components<a class="headerlink" href="#environment-components" title="Permalink to this heading">¶</a></h2>
<p>The environment creates and manages several underlying data structures that define the state and affect it through actions.</p>
<section id="passenger">
<h3>Passenger<a class="headerlink" href="#passenger" title="Permalink to this heading">¶</a></h3>
<p>The base component of the environment is the <code class="docutils literal notranslate"><span class="pre">Passenger</span></code>. Each passenger arrives at a floor in the building, and has a destination floor they want to get through, that is not their arrival floor. Based on whether their destination floor is above or below their arrival floor, they will try to join the corresponding elevator queue on that floor.</p>
<p>If the queue they are trying to join is full, they will not join any queue, and their rejection will be tracked and included in the reward function.</p>
<p>When they arrive in the building, they track the timestep at which they arrived, as well as setting both a wait time and overall age to zero. The wait time tracks how many steps they spent in an elevator queue and it will not be incremented if they enter an elevator. The age increases at every timestep regardless of location.</p>
<p>Each passenger has a maximum amount of steps they will wait in a queue before leaving the queue, at which point their departure will be noted and included in the reward function.</p>
</section>
<section id="passenger-arrival-generator">
<h3>Passenger Arrival Generator<a class="headerlink" href="#passenger-arrival-generator" title="Permalink to this heading">¶</a></h3>
<p>The passenger arrival generator’s function is to generate new passengers at the beginning every time step in the environment, and it is comprised of two main components:</p>
<ul class="simple">
<li><p>Floor arrival rates</p>
<ul>
<li><p>We use the <a class="reference external" href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a> to model the random arrival of passengers on each floor.</p></li>
<li><p>The distribution is defined by a single lambda value, and the arrival generator holds a lambda value for each floor.</p></li>
<li><p>Low lambda values may have zero arrivals for a floor on a given turn, while higher values may have from zero to multiple.</p></li>
</ul>
</li>
<li><p>Floor destination rates</p>
<ul>
<li><p>When passengers are created and are defined as arriving on a specific floor, we want to randomly determine what their destination floor is.</p></li>
<li><p>Each floor has a list of probabilities for the number of floors in the building that meets the following conditions:</p>
<ul>
<li><p>The sum of all probabilities must sum to one.</p></li>
<li><p>The arrival floor probability must be set to zero since passengers will never want to take an elevator to the same floor.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<section id="default-parameters">
<h4>Default Parameters<a class="headerlink" href="#default-parameters" title="Permalink to this heading">¶</a></h4>
<p>While this is a flexible system, we have implemented a default case where the arrival rate of the ground floor is highest, while all other floors have a low arrival rate. Correspondingly, the ground floor has a random chance to go to any non-ground floor, while the non-ground floors most often want to go to the ground floor with a small chance to head to another non-ground floor.</p>
<p>Please see the <code class="docutils literal notranslate"><span class="pre">arrivals.PassengerArrivals.generate_default_params</span></code> function for details.</p>
</section>
</section>
<section id="elevator">
<h3>Elevator<a class="headerlink" href="#elevator" title="Permalink to this heading">¶</a></h3>
<p>Each building has at least one elevator, and each elevator’s function is (obviously) to pick up passengers from queues and drop them off on their destination floors. All actions are executed by the elevators in the system, whereas the passengers are just part of the state and reward function.</p>
<p>The elevators have a minimum and maximum floor range that they can visit, and they have a maximum number of passengers they can hold at one time. It knows what floor it is currently on and what passengers are riding it.</p>
<p>The default parameters for elevators set their floor range to be the entire building, but the user can modify this to configure non-standard elevator arrangements where some only service the bottom part of the building and others the top.</p>
</section>
<section id="building">
<h3>Building<a class="headerlink" href="#building" title="Permalink to this heading">¶</a></h3>
<p>The building is a wrapper that holds the elevators and elevator waiting queues, and it manages passenger arrivals, executes actions, steps the environment forwards, manages observations and reward function components, and handles the small details such as passenger queue rejections, aging forwards, etc. Ultimately, this class holds most of the main logic surrounding state, and the environment is just a wrapper around this.</p>
</section>
</section>
<section id="action-space">
<h2>Action Space<a class="headerlink" href="#action-space" title="Permalink to this heading">¶</a></h2>
<p>There are 6 actions that an elevator can take:</p>
<ol class="arabic simple" start="0">
<li><p>Do nothing and remain at the current floor.</p></li>
<li><p>Attempt to move up a floor. This does nothing if at the
elevator’s maximum floor.</p></li>
<li><p>Attempt to move down a floor. This does nothing if at the
elevator’s minimum floor.</p></li>
<li><p>Load as many passengers will fit in the remaining elevator
capacity from the current floor that are in the up queue
starting from the first arrived passengers onward.</p></li>
<li><p>Load as many passengers will fit in the remaining elevator
capacity from the current floor that are in the down queue
starting from the first arrived passengers onward.</p></li>
<li><p>Unload any passengers that have their destination floor as
the elevator’s current floor.</p></li>
</ol>
<p>These are implemented in the gymnasium <a class="reference external" href="https://gymnasium.farama.org/api/spaces/fundamental/#multidiscrete"><code class="docutils literal notranslate"><span class="pre">MultiDisrete</span></code></a> space, with one action to be passed into each step for each elevator in the building.</p>
</section>
<section id="observation-space">
<h2>Observation Space<a class="headerlink" href="#observation-space" title="Permalink to this heading">¶</a></h2>
<p>The observation space is currently a WIP, and, though we have multiple options for observation spaces planned, only the <code class="docutils literal notranslate"><span class="pre">limited</span></code> observation space is currently implemented.</p>
<p>The limited observation space is meant to mimic a realistic elevator environment, where only available data to an elevator system are what buttons are pressed on each floor for the queues, as well as the destination floor buttons within the elevators. We don’t know any of the passengers’ true destinations in the queue or how many passengers pressed the destination buttons. Lastly, the elevators know what floor they are on.</p>
<p>The raw observation space is implemented as a <a class="reference external" href="https://gymnasium.farama.org/api/spaces/composite/#dict"><code class="docutils literal notranslate"><span class="pre">Dict</span></code></a> space with <a class="reference external" href="https://gymnasium.farama.org/api/spaces/fundamental/#multibinary"><code class="docutils literal notranslate"><span class="pre">MultiBinary</span></code></a> spaces for the elevator buttons and queue buttons, with a <code class="docutils literal notranslate"><span class="pre">MultiDiscrete</span></code> space for the elevator locations.</p>
<p>Unfortunately, not all learning algorithms are built to work with the <code class="docutils literal notranslate"><span class="pre">Dict</span></code> space, so we have a <code class="docutils literal notranslate"><span class="pre">flatten_space</span></code> parameter in the environment that takes all of the <code class="docutils literal notranslate"><span class="pre">Dict</span></code> components above and turns it into a large <code class="docutils literal notranslate"><span class="pre">MultiBinary</span></code> space equal to length (<code class="docutils literal notranslate"><span class="pre">num_floors</span> <span class="pre">x</span> <span class="pre">num_elevators</span></code>) + (<code class="docutils literal notranslate"><span class="pre">num_floors</span> <span class="pre">x</span> <span class="pre">2</span></code>) + (<code class="docutils literal notranslate"><span class="pre">num_floors</span> <span class="pre">x</span> <span class="pre">num_elevators</span></code>) corresponding to the elevator buttons, elevator queues, and elevator locations respectively. This should be compatible with common tools such as <a class="reference external" href="https://stable-baselines3.readthedocs.io/en/master/">stable-baselines</a>.</p>
</section>
<section id="environment-step">
<h2>Environment Step<a class="headerlink" href="#environment-step" title="Permalink to this heading">¶</a></h2>
<p>The environment step function does the usual things one would expect from a gymnasium environment, but here are the details about what happens to the underlying component states:</p>
<ol class="arabic simple">
<li><p>Generate new passengers with the passenger arrival generator</p></li>
<li><p>Remove passengers in elevator queues that have reached their maximum wait time</p></li>
<li><p>Attempt to add new passengers to elevator queues and tracking failed joins from maximum size queues</p></li>
<li><p>Execute each action for each elevator in the building in the order they were provided; the first elevator in the building elevators list executes the first action passed into the step function</p></li>
<li><p>Increment passenger wait and age properties</p></li>
<li><p>Increment the environment step number</p></li>
<li><p>Return observation space, reward and termination status</p></li>
</ol>
</section>
<section id="reward-function">
<h2>Reward Function<a class="headerlink" href="#reward-function" title="Permalink to this heading">¶</a></h2>
<p>The reward function applies a dictionary of weights to multiplied by the corresponding attributes returned from the building. There are positive and negative components to the reward function that should contribute positively and negatively to the final reward value respectively.</p>
<p>Below, the components are listed in order from highest to lowest weights using the default parameters, although the user can provide any of their own weights to the environment.</p>
<section id="positive-components">
<h3>Positive Components<a class="headerlink" href="#positive-components" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>The count of assengers unloaded to their destination floor</p></li>
<li><p>The count of passengers that were moved toward their destination floor while in an elevator</p></li>
</ul>
</section>
<section id="negative-components">
<h3>Negative Components<a class="headerlink" href="#negative-components" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>The count of passengers that tried to join a full queue and were denied</p></li>
<li><p>The count of passengers that reached their maximum wait time and left the queue</p></li>
<li><p>The count of passengers that were moved away from their destination floor while in an elevator</p></li>
<li><p>The count of passengers in an elevator</p></li>
<li><p>The count of passengers in a queue</p></li>
</ul>
</section>
</section>
<section id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this heading">¶</a></h2>
<p>While this environment is designed to work without any additional definition inputs from the user, it can be modified by the user in a number of ways to test alternative goals and building layout scenarios:</p>
<ul class="simple">
<li><p>Simulating a workout gym/restaurant on an upper floor by increasing its destination probability and arrival probabilities</p></li>
<li><p>Restricting certain elevators to only lower or upper floors to focus on localized transport for buildings with a lot of non-ground floor travel.</p></li>
<li><p>Prioritizing getting passengers onto elevators at the cost of going in the opposite direction for a floor or two rather than having them continue to wait and max out queues.</p></li>
</ul>
<p>This is a well-researched subject area, but as buildings become larger and more complicated, we believe that reinforcement learning may be a way to test novel configurations and automatically generate policies rather than involve lengthy manual implementations.</p>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading">¶</a></h2>
<p>We have some large assumptions around the equivalence of various actions’ time for execution which make it unrealistic for a real elevator environment, but which speed up the environment’s execution time but not having to learn actions for every single second.</p>
<p>Additionally, the visual rendering part of the environment is not yet implemented.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RLevator</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#environment-components">Environment Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#action-space">Action Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="#observation-space">Observation Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-step">Environment Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reward-function">Reward Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-usage">Advanced Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RLevator Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rlevator.html">rlevator package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to RLevator’s documentation!</a></li>
      <li>Next: <a href="rlevator.html" title="next chapter">rlevator package</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Matthew Burke.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/environment.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>